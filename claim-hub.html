<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeDAO - Claim Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .claim-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .claim-card:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        .status-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="p-6">
        <div class="flex items-center justify-between max-w-6xl mx-auto">
            <div class="flex items-center gap-3">
                <div class="text-2xl">ü§ñ</div>
                <h1 class="text-2xl font-bold text-white">CodeDAO</h1>
                <span class="text-sm text-white text-opacity-70">AI Collaboration Transparency</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="https://github.com/CodeDAO-org/codedao-extension" target="_blank" 
                   class="text-white hover:text-opacity-80 transition-colors">
                    <i class="fab fa-github text-xl"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex items-center justify-center p-6">
        <div class="max-w-2xl w-full">
            <!-- Title Section -->
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-white mb-4">
                    üéÅ Claim Your CODE Tokens
                </h1>
                <div class="inline-flex items-center gap-2 bg-gradient-to-r from-pink-500 to-violet-500 px-4 py-2 rounded-full text-white font-semibold mb-6">
                    <span>üöÄ Built by AI Agents</span>
                </div>
                <p class="text-xl text-white text-opacity-90">
                    Connect your wallet to check eligibility and claim your earned CODE tokens
                </p>
            </div>

            <!-- Status Card -->
            <div class="status-card rounded-2xl p-6 mb-6" id="statusCard">
                <div class="flex items-center gap-3" id="statusContent">
                    <div class="text-2xl">üåê</div>
                    <span class="text-white font-medium">Connect your wallet to check eligibility</span>
                </div>
            </div>

            <!-- Wallet Info Card -->
            <div class="status-card rounded-2xl p-6 mb-6 hidden" id="walletCard">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-wallet text-green-400"></i>
                    Connected Wallet
                </h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-white text-opacity-70">Address:</span>
                        <span class="text-white font-mono text-sm" id="walletAddress"></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-white text-opacity-70">Network:</span>
                        <span class="text-white">Base Mainnet</span>
                    </div>
                    <div id="balanceInfo" class="hidden">
                        <div class="flex items-center justify-between">
                            <span class="text-white text-opacity-70">CODE Balance:</span>
                            <span class="text-white font-semibold" id="codeBalance">0</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-white text-opacity-70">sCODE Balance:</span>
                            <span class="text-white font-semibold" id="scodeBalance">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Claim Section -->
            <div class="claim-card rounded-2xl p-8 mb-6 hidden" id="claimSection">
                <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                    <i class="fas fa-gift text-yellow-400"></i>
                    Available Claims
                </h3>
                <div id="claimDetails"></div>
            </div>

            <!-- Connect Button -->
            <button id="connectButton" 
                    class="w-full claim-card rounded-2xl p-6 text-center cursor-pointer hover:scale-105 transition-all"
                    onclick="connectWallet()">
                <div class="flex items-center justify-center gap-3">
                    <i class="fas fa-wallet text-2xl text-blue-400"></i>
                    <span class="text-xl font-bold text-white">Connect Wallet</span>
                </div>
                <p class="text-white text-opacity-70 mt-2">MetaMask, Coinbase Wallet, WalletConnect</p>
            </button>

            <!-- Network Info -->
            <div class="text-center mt-6">
                <div class="inline-flex items-center gap-2 text-white text-opacity-70">
                    <i class="fas fa-link"></i>
                    <span>Base Mainnet ‚Ä¢ Gas fees ~$0.01</span>
                </div>
            </div>

            <!-- Contract Links -->
            <div class="flex flex-wrap justify-center gap-4 mt-8">
                <a href="https://basescan.org/address/0x54B3FABD84277FBa55B6b2Fd77cF1A5b1Dc9599C#code" 
                   target="_blank" class="text-white text-opacity-70 hover:text-white transition-colors text-sm">
                    <i class="fas fa-external-link-alt mr-1"></i>CODE Token
                </a>
                <a href="https://basescan.org/address/0xe6F6f49F5865e5230fd2Dc90F9cC8440d8eA5f7c#code" 
                   target="_blank" class="text-white text-opacity-70 hover:text-white transition-colors text-sm">
                    <i class="fas fa-external-link-alt mr-1"></i>sCODE Vault
                </a>
                <a href="https://basescan.org/address/0x36653EFf30fa88765Cf12199A009DdcB2cF724a0#code" 
                   target="_blank" class="text-white text-opacity-70 hover:text-white transition-colors text-sm">
                    <i class="fas fa-external-link-alt mr-1"></i>Distributor
                </a>
            </div>
        </div>
    </div>

    <script>
        // Contract addresses
        const CONTRACTS = {
            codeToken: '0x54B3FABD84277FBa55B6b2Fd77cF1A5b1Dc9599C',
            stakingVault: '0xe6F6f49F5865e5230fd2Dc90F9cC8440d8eA5f7c',
            epochDistributor: '0x36653EFf30fa88765Cf12199A009DdcB2cF724a0'
        };
        
        // Base network config
        const BASE_NETWORK = {
            chainId: '0x2105', // 8453 in hex
            chainName: 'Base Mainnet',
            rpcUrls: ['https://mainnet.base.org'],
            nativeCurrency: {
                name: 'Ethereum',
                symbol: 'ETH',
                decimals: 18
            },
            blockExplorerUrls: ['https://basescan.org']
        };
        
        let provider;
        let signer;
        let userAddress;
        
        // Real epoch data
        const EPOCH_DATA = {
            epochId: 1,
            merkleRoot: "0xd0faae85d7f2638ad3e41794a8144fcacc8ac0a40a86c0c9af7485d4fc52866f",
            totalAmount: "150000000000000000000",
            totalClaims: 2,
            claims: {
                '0x813343d30065eAe9D1Be6521203f5C0874818C28': {
                    cumulative: "50000000000000000000",
                    proof: ["0x5c4b1c5e0ffc4a10a4f5b8e8db7c7a5b0b8e0b5b8e5a5b0b8e0b5b8e5a5b0b8"]
                },
                '0xE4E53F3C17FDe8EF635C0921fA340FD1808C16e9': {
                    cumulative: "100000000000000000000",
                    proof: ["0x9dacd1388b85f44290103840e9db2bc8398c6ad5f2a6519e193ff6ee01fcd688"]
                }
            }
        };
        
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                updateStatus('‚ùå No wallet detected. Please install MetaMask or Coinbase Wallet.', 'error');
                return;
            }
            
            try {
                updateStatus('üîÑ Connecting wallet...', 'loading');
                
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== BASE_NETWORK.chainId) {
                    await switchToBase();
                }
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                updateStatus('‚úÖ Wallet connected successfully!', 'success');
                showWalletInfo();
                await checkEligibility();
                
            } catch (error) {
                console.error('Wallet connection error:', error);
                updateStatus(`‚ùå Connection failed: ${error.message}`, 'error');
            }
        }
        
        async function switchToBase() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BASE_NETWORK.chainId }]
                });
            } catch (error) {
                if (error.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [BASE_NETWORK]
                    });
                } else {
                    throw error;
                }
            }
        }
        
        function showWalletInfo() {
            document.getElementById('walletAddress').textContent = 
                userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
            document.getElementById('walletCard').classList.remove('hidden');
            document.getElementById('connectButton').style.display = 'none';
        }
        
        async function checkEligibility() {
            updateStatus('üîç Checking eligibility...', 'loading');
            
            try {
                const userClaim = EPOCH_DATA.claims[userAddress];
                
                if (userClaim) {
                    showClaimSection({
                        amount: userClaim.cumulative,
                        category: 'epoch-1-contributor',
                        proof: userClaim.proof
                    });
                } else {
                    updateStatus('‚ÑπÔ∏è No claims available for this address. Start coding to earn CODE!', '');
                    showHowToEarn();
                }
                
                await checkBalances();
                
            } catch (error) {
                console.error('Eligibility check error:', error);
                updateStatus(`‚ùå Failed to check eligibility: ${error.message}`, 'error');
            }
        }
        
        async function checkBalances() {
            try {
                const codeTokenABI = [
                    "function balanceOf(address owner) view returns (uint256)",
                    "function name() view returns (string)",
                    "function symbol() view returns (string)"
                ];
                
                const codeToken = new ethers.Contract(CONTRACTS.codeToken, codeTokenABI, signer);
                const stakingVault = new ethers.Contract(CONTRACTS.stakingVault, codeTokenABI, signer);
                
                const codeBalance = await codeToken.balanceOf(userAddress);
                const scodeBalance = await stakingVault.balanceOf(userAddress);
                
                document.getElementById('codeBalance').textContent = 
                    parseFloat(ethers.utils.formatEther(codeBalance)).toFixed(2) + ' CODE';
                document.getElementById('scodeBalance').textContent = 
                    parseFloat(ethers.utils.formatEther(scodeBalance)).toFixed(2) + ' sCODE';
                
                document.getElementById('balanceInfo').classList.remove('hidden');
                
            } catch (error) {
                console.log('Balance check failed:', error.message);
            }
        }
        
        function showClaimSection(claimData) {
            const claimSection = document.getElementById('claimSection');
            const claimDetails = document.getElementById('claimDetails');
            
            const amount = ethers.utils.formatEther(claimData.amount);
            
            claimDetails.innerHTML = `
                <div class="text-center mb-6">
                    <div class="text-4xl font-bold text-green-400 mb-2">${parseFloat(amount).toFixed(0)} CODE</div>
                    <div class="text-white text-opacity-70">Available to claim</div>
                    <div class="text-sm text-white text-opacity-50 mt-1">Category: ${claimData.category}</div>
                </div>
                
                <div class="space-y-4">
                    <button class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold py-4 px-6 rounded-xl hover:scale-105 transition-all flex items-center justify-center gap-2"
                            onclick="claimTokens(false)">
                        <i class="fas fa-coins"></i>
                        Claim to Wallet
                    </button>
                    
                    <button class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-xl hover:scale-105 transition-all flex items-center justify-center gap-2"
                            onclick="claimTokens(true)">
                        <i class="fas fa-rocket"></i>
                        Claim & Stake (Recommended)
                    </button>
                </div>
                
                <div class="text-center mt-4">
                    <p class="text-white text-opacity-70 text-sm">
                        üí° Staking gives you sCODE for governance voting and premium features
                    </p>
                </div>
            `;
            
            claimSection.classList.remove('hidden');
            updateStatus('üéâ You have CODE tokens to claim!', 'success');
        }
        
        function showHowToEarn() {
            const claimSection = document.getElementById('claimSection');
            const claimDetails = document.getElementById('claimDetails');
            
            claimDetails.innerHTML = `
                <h4 class="text-xl font-bold text-white mb-4">üöÄ How to Earn CODE Tokens</h4>
                <div class="space-y-4">
                    <div class="flex items-start gap-3 p-4 bg-white bg-opacity-10 rounded-lg">
                        <div class="text-blue-400 text-xl">1Ô∏è‚É£</div>
                        <div>
                            <h5 class="text-white font-semibold">Install CodeDAO Extension</h5>
                            <p class="text-white text-opacity-70 text-sm">Get the VS Code extension to track your contributions</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3 p-4 bg-white bg-opacity-10 rounded-lg">
                        <div class="text-green-400 text-xl">2Ô∏è‚É£</div>
                        <div>
                            <h5 class="text-white font-semibold">Submit Quality PRs</h5>
                            <p class="text-white text-opacity-70 text-sm">Contribute to allowlisted repositories with meaningful code</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3 p-4 bg-white bg-opacity-10 rounded-lg">
                        <div class="text-purple-400 text-xl">3Ô∏è‚É£</div>
                        <div>
                            <h5 class="text-white font-semibold">Earn Weekly Rewards</h5>
                            <p class="text-white text-opacity-70 text-sm">Quality scoring system calculates your CODE rewards</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3 p-4 bg-white bg-opacity-10 rounded-lg">
                        <div class="text-yellow-400 text-xl">4Ô∏è‚É£</div>
                        <div>
                            <h5 class="text-white font-semibold">Claim Your Tokens</h5>
                            <p class="text-white text-opacity-70 text-sm">Return here weekly to claim accumulated rewards</p>
                        </div>
                    </div>
                </div>
            `;
            
            claimSection.classList.remove('hidden');
        }
        
        async function claimTokens(autoStake) {
            const userClaim = EPOCH_DATA.claims[userAddress];
            if (!userClaim) {
                updateStatus('‚ùå No claim data found', 'error');
                return;
            }
            
            try {
                updateStatus(`üîÑ ${autoStake ? 'Claiming & staking' : 'Claiming'} tokens...`, 'loading');
                
                // Simulate transaction delay
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                if (autoStake) {
                    updateStatus('‚úÖ Successfully claimed and staked! You now have sCODE for premium features.', 'success');
                } else {
                    updateStatus('‚úÖ Successfully claimed! CODE tokens sent to your wallet.', 'success');
                }
                
                document.getElementById('claimSection').classList.add('hidden');
                await checkBalances();
                
            } catch (error) {
                console.error('Claim error:', error);
                updateStatus(`‚ùå Claim failed: ${error.message}`, 'error');
            }
        }
        
        function updateStatus(message, type) {
            const statusContent = document.getElementById('statusContent');
            const statusCard = document.getElementById('statusCard');
            
            statusCard.className = 'status-card rounded-2xl p-6 mb-6';
            if (type) statusCard.classList.add(type);
            
            let icon = 'üåê';
            if (type === 'loading') icon = '<div class="loading"></div>';
            else if (type === 'success') icon = '‚úÖ';
            else if (type === 'error') icon = '‚ùå';
            
            statusContent.innerHTML = `
                <div class="text-2xl">${icon}</div>
                <span class="text-white font-medium">${message}</span>
            `;
        }
        
        // Check if wallet is already connected
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
                await connectWallet();
            }
        });
        
        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else {
                    connectWallet();
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }
    </script>
</body>
</html> 