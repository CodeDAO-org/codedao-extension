name: CodeDAO Reddit Bot

on:
  schedule:
    # Every 4 hours for maximum weekend engagement
    - cron: '0 */4 * * *'
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        default: 'weekend_thread'
        type: choice
        options:
        - weekend_thread
        - test_connection
        - milestone_post

jobs:
  reddit-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install Reddit Bot Dependencies
      run: |
        pip install praw python-dotenv
    
    - name: Execute Reddit Bot Action
      env:
        REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
        REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
        REDDIT_USERNAME: ${{ secrets.REDDIT_USERNAME }}
        REDDIT_PASSWORD: ${{ secrets.REDDIT_PASSWORD }}
        REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}
        REDDIT_SUBREDDIT: ${{ secrets.REDDIT_SUBREDDIT }}
      run: |
        python -c "
        import os
        import praw
        from datetime import datetime
        
        # Initialize Reddit connection
        reddit = praw.Reddit(
            client_id=os.getenv('REDDIT_CLIENT_ID'),
            client_secret=os.getenv('REDDIT_CLIENT_SECRET'),
            username=os.getenv('REDDIT_USERNAME'),
            password=os.getenv('REDDIT_PASSWORD'),
            user_agent=os.getenv('REDDIT_USER_AGENT')
        )
        
        action = '${{ github.event.inputs.action }}' or 'weekend_thread'
        subreddit_name = os.getenv('REDDIT_SUBREDDIT', 'CodeDAO')
        subreddit = reddit.subreddit(subreddit_name)
        
        print(f'ğŸ”Œ Connected to Reddit as: {reddit.user.me()}')
        print(f'ğŸ¯ Target subreddit: r/{subreddit_name}')
        print(f'âš¡ Action: {action}')
        
        if action == 'test_connection':
            print('âœ… Reddit bot connection test successful!')
            print(f'ğŸ“Š Account karma: {reddit.user.me().comment_karma + reddit.user.me().link_karma}')
            
        elif action == 'milestone_post':
            # Simple milestone post
            title = 'ğŸ‰ CodeDAO Community Milestone!'
            content = '''**Exciting news from the CodeDAO community!**
            
A new milestone has been reached in our developer ecosystem.

**Join the CodeDAO Community:**
- ğŸŒ **Dashboard**: https://codedao-org.github.io/dashboard.html
- ğŸ“š **Get Started**: https://codedao-org.github.io/get-started.html
- ğŸ’° **Earn CODE tokens** for your coding contributions
- ğŸ¤ **Connect with developers** building the future

Keep building, keep earning! ğŸš€

*Posted by CodeDAO Bot*'''
            
            post = subreddit.submit(title=title, selftext=content)
            print(f'ğŸ‰ Posted milestone: {post.url}')
            print(f'ğŸ“Š Post ID: {post.id}')
            
        else:  # weekend_thread (default)
            # Enhanced weekend builder thread
            current_time = datetime.now()
            day_name = current_time.strftime('%A')
            
            title = f'ğŸš€ {day_name} Builder Thread - What are you coding?'
            
            content = f'''**Welcome to the {day_name} CodeDAO builder thread!**

**Share what you are working on:**
- ğŸ’» Current coding projects and features
- ğŸ”§ Weekend hacks and experiments  
- ğŸ› Bugs you are crushing
- ğŸ¯ New technologies you are learning
- ğŸš€ Cool discoveries and breakthroughs

**CodeDAO Resources:**
- ğŸŒ **Dashboard**: https://codedao-org.github.io/dashboard.html
- ğŸ“– **Get Started Guide**: https://codedao-org.github.io/get-started.html
- ğŸ’° **Earn CODE tokens**: Track contributions and get rewarded
- ğŸ¤ **Peer Review**: Get feedback on your code
- ğŸ“Š **Quality Scoring**: AI-powered code analysis

**Community Guidelines:**
- Share your progress, no matter how small
- Ask questions and offer help to others
- Include links to your projects when possible
- Celebrate wins and learn from challenges

**Remember**: Every commit, every PR, every contribution makes you a better developer. The CodeDAO community is here to support your journey! 

Let us build the future together! ğŸ”¥

---
*ğŸ¤– This thread is automatically posted every 4 hours to keep our community active. Join the conversation and share your coding adventures!*

*Posted by CodeDAO Bot | {current_time.strftime('%Y-%m-%d %H:%M UTC')}*'''
            
            post = subreddit.submit(title=title, selftext=content)
            print(f'âœ… Posted {day_name} builder thread: {post.url}')
            print(f'ğŸ“Š Post ID: {post.id}')
            print(f'ğŸ• Posted at: {current_time.strftime('%Y-%m-%d %H:%M:%S UTC')}')
            
        print('ğŸ¯ Reddit bot execution completed successfully!')
        "
    
    - name: Log Execution Summary
      run: |
        echo "Reddit Bot Execution Summary:"
        echo "Timestamp: $(date)"
        echo "Action: ${{ github.event.inputs.action || 'weekend_thread' }}"
        echo "Status: Completed"
        echo "Track posts at: https://reddit.com/u/${{ secrets.REDDIT_USERNAME }}" 